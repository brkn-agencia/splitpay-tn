<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Reglas</title>
  <style>
    body { font-family: Arial; max-width: 1100px; margin: 24px auto; }
    table { width:100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #eee; padding: 10px; text-align:left; }
    .box { background: #fafafa; border: 1px solid #ddd; padding: 16px; border-radius: 10px; margin-bottom: 16px;}
    select, input { padding: 6px; }
  </style>
</head>
<body>
  <h1>Reglas - Tienda {{tn_store_id}}</h1>
  <p><a href="/dashboard?admin_key={{admin_key}}">← volver</a></p>

  <div class="box">
    <form method="post" action="/dashboard/{{tn_store_id}}/rules/add?admin_key={{admin_key}}">
      <h3>Nueva regla</h3>
      <p>
        Scope:
        <select name="scope">
          <option value="product">Producto</option>
          <option value="category">Categoría</option>
          <option value="global">Global</option>
        </select>
      </p>
      <p>Reference ID (product_id o category_id; vacío si global):<br/>
        <input name="reference_id" style="width:420px">
      </p>
      <p>Máximo cuotas:
        <select name="max_installments">
          <option value="12">12</option>
          <option value="6">6</option>
          <option value="0">0</option>
        </select>
      </p>
      <button type="submit">Agregar regla</button>
    </form>
  </div>

  <div class="box">
    <h3>Reglas actuales</h3>
    <table>
      <tr><th>ID</th><th>Scope</th><th>Reference</th><th>Max cuotas</th><th>Activa</th><th></th></tr>
      {% for r in rules %}
        <tr>
          <td>{{r["id"]}}</td>
          <td>{{r["scope"]}}</td>
          <td>{{r["reference_id"] or "-"}}</td>
          <td>{{r["max_installments"]}}</td>
          <td>{{"Sí" if r["active"] else "No"}}</td>
          <td>
            <form method="post" action="/dashboard/{{tn_store_id}}/rules/toggle/{{r['id']}}?admin_key={{admin_key}}" style="display:inline">
              <button type="submit">{{"Desactivar" if r["active"] else "Activar"}}</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </table>
  </div>
</body>
</html>
